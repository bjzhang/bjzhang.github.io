---
layout: post
title: 梳理下国内的自研CPU
categories: [Tech]
tags: [Tech, CPU]
---

最近中兴事件大家议论很多。笔者一直觉得专业的人做专业的事情，经济，贸易这些我也不太懂。恰好是芯片专业，后来一直做操作系统相关的工作，这些年对于国内cpu，soc也比较关注。正好借这个机会梳理下。

上大学的时候，学校的一个机房曾经也部署过方舟CPU的瘦客户端。过了两年，换成普通PC了，当时的瓶颈似乎是带宽不够。我觉得领先两步是烈士，当年我们各个方面差距非常大，这些年我们虽然高端制造还有极大差距，但是很多东西还是追了上来。但是如果没有方舟们之前的工作，没有当时方舟的成功流片，就没有后来我们对体系结构这么深的理解，也没有君正，申威，国防科大，展讯等很多公司现在能够继续在自研CPU上继续往下走。操作系统方面，我们现在虽然没有一个能够有完整生态操作系统，但是在嵌入式领域，我们有rt-thread。在操作系统的探索方面，我们有全球操作系统大牛陈海波。

笔者收集了一些国内公司CPU的情况。首先需要说明的是，国内CPU公司的设计不一定都在国内，技术发展水平，美国出口限制（并不是专门针对大陆）等原因导致很多国内公司CPU的一部分设计在国外。如前文所有，像剥洋葱一样，一步一步的解决技术问题就好。

CPU其实有不同的场景，也有不同的需求。做东西还是为了满足诉求，不是为了做而做。比如国家安全，比如针对自己场景做特定的优化。超算领域，我们有申威CPU，手机芯片有展讯的SC9850KH，服务器方面我们有龙芯。

澄清：cpu和soc的区别。CPU，DSP，MCU的区别。

scoping: 只说cpu，不说操作系统。也不说我们差距更大的芯片制造。

思路：
1.  发展历史，剥洋葱消化吸收的过程。
2.  目前最新处理器的架构和生态。

申威
---
申威处理器又称"SW处理器"，具体负责研发的单位是江南计算机所属于军方研究机构(总参56所)，2006年推出第一代处理器，目前共有4代处理器。其中前三代源于DEC Alpha架构。第四代26010架构不详，官方文档明确说不是alpha架构(Shenwei-64  Instruction Set (this is NOT related to the DEC Alpha instruction set))，架构设计类似与Power cell架构：每个通用处理核心与64个SIMD向量处理器搭配，每个计算节点共4个通用处理器+256个计算节点（256 CPEs (computing  processing  elements) + 4  MPEs (management processing  elements)）

龙芯
---
龙芯(Loongson)是中科院计算所研发的，属于mips兼容架构。2002年推出第一代处理器（32位）。2003年10月17日，龙芯2号首片MZD110流片成功，纪念毛泽东主席诞辰110周年。最新一代是龙芯3。成功流片后，计算所内部服务器替换使用龙芯服务器。
作为一款通用处理器，龙芯至迟从2004年开始做x86软件运行加速工作，基本有两个思路，一个是硬件指令集扩展；一个是软件DBT优化(解释DBT)。
龙芯已经成为Debian的mipsel架构的编译机器。
mips是个老牌架构。
龙芯的Loongson ISA在mips上也有扩展，其实也是个消化吸收并针对需求优化的国产。

TODO 本人原来在华为做Linux内核，现在在海航云做分布式存储。对国内cpu发展一直比较关注，想请教下面问题是否可以分享下：
1.  龙芯下一代产品的指标。
2.  龙芯对于x86软件的支持方式？指令集支持？DBT模拟？目前性能损失有多少?
3.  看到debian编译mips使用了龙芯的芯片，请问龙芯对于开源社区支持的具体情况如何？

展讯
---
展讯除了arm架构还有和intel合作的cpu。这里只说arm。arm架构的特点是在移动端android生态完善，在HPC，云计算方面有多家公司持续投入。例如老牌网络公司cavium，占领欧洲的发行版公司suse，惠普功能在英国（TODO链接）上线HPC项目。云计算方面，阿里上线测试arm64服务器。这些都是arm生态的机会。

展讯，当年因为中国移动运营的TD-SCDMA步调慢，差点死掉。后来凭借TD的订单，一直持续投入做基带芯片，并且逐步开始做手机AP芯片。也就是我们说的手机CPU。后来才有了现在说的自研CPU。

SC9850KH，<https://mp.weixin.qq.com/s/0jH4uoEv0UsMuKOFZiozIQ>。从文章看，主打性能功耗比，是cortex-A53的竟品：[首款国产
自主手机CPU，紫光展锐SC9850KH正式亮相](http://t.cj.sina.com.cn/articles/view/5772303575/1580e5cd7001004pvx?cre=tianyi&mod=pcpager_fintoutiao&loc=13&r=9&doct=0&rfunc=100&tj=none&tr=9):
"ARM架构下实现了双线程"

架构之争
--------
网上很多人讲x86和arm架构的历史，不就重复了。也有人说跳出cpu和操作系统，直接用javascript跳跃式发展(TODO 链接)。笔者这里不讨论是否可以，业务软件我不懂，这部分业务和应用软件的专家和吃瓜群众讨论就好了。我这里只讨论cpu和操作系统。

那么聚焦到CPU和操作系统，到底选择什么样的架构？要不要做一个全新的自己的操作系统？这个问题我也不打算回答，我还是聊一聊这个历史。展讯的李力游最近去了imagination. Imagination当年mips CPU. 大家如果注意到的话，当年imagination买了mips公司，但是mips的知识产权其实是由三家公司组成的投资公司买的，这三家投资公司之一就是arm. arm为什么要这样做？mips是risc架构的始祖，其实一个重要的原因就是64位arm处理器架构里面涉及到大量misp的专利。其实这件事情翻出来说看人，你就会发现，很多原来做过mips架构的人，现在正在做arm架构的东西。体系结构其实有万千，但是万变不离其宗，其实我们国家做不管是mips还是arm都属于对总体来说都属于risc。在扩大些说，不管是RISC还是CISC，其实关键的点，比如说性能功耗比，它主要取决于微架构设计，而微架构其实在体系结构之间，哪怕是cisc和rics间都是高度共通的，所以这种CPU微架构的设计，其实不管做什么体系结构，都会有积累。
就像intel当年想做嵌入式，选择了arm，和ADI联合研发体系结构，并设计了xcale系列SOC。后来xcale卖给了marvell。直到现在marvell仍然是沿着xcale架构的路线持续演进。

TODO MIPS, arm, SPARC架构比较。

杂七杂八
--------
国内明确做cpu的其实还有两家，一个是国防科大的飞腾，一个是兆芯。
国防科大飞腾：原来是sparcv8, 现在是armv8，前年飞腾arm64芯片出来时争议很大，从芯片spec看只能用在服务器领域。兆芯：x86，2018年授权到期，据说只是不能用2018年之后的指令集，原来指令集授权仍然有效。这两家公司笔者不太了解，不细说了。

另外一个值得说一说的公司是华为，华为的海思，从20多年以前开始做芯片，目前的芯片已经广泛用到华为各个产品线中，华为的手机也从最开始的k3的祖传暖手宝，到现在的麒麟970，性能逐渐改善，并且目前已用在华为所有的中高端手机中，年出货量超过千万。这里就有个问题，华为有没有做CPU？2016年的时候，曾经有文章说华为的泰山自研CPU，但是随后被华为辟谣，我们不去讨论华为目前有没有自研CPU，但是笔者说的展讯发展的路线就可以看出来，从做SOC到做CPU是一个逐步深入的过程，因此不管华为有没有做自己的CPU，华为做SOC所培养的技术人才，对于我们做CPU来说都是非常重要的积累。
顺便八卦一下，k3是欧洲的TODO 山，现在华为的泰山是中国自己的山。我这说明了华为心中的志向。详情请见任正非2012年的讲话(TODO)。

最近看朋友圈说："都两个肩膀扛一个脑袋，啥高科技都架不住你天天琢磨。”

参考链接
--------
1.  申威
    1.  <http://www.netlib.org/utk/people/JackDongarra/PAPERS/sunway-report-2016.pdf>
    2.  <https://zh.wikipedia.org/wiki/%E7%94%B3%E5%A8%81%E5%A4%84%E7%90%86%E5%99%A8>
    3.  <http://www.eefocus.com/mcu-dsp/370966/r0>
2.  龙芯
    1.  <https://zh.wikipedia.org/wiki/%E9%BE%99%E8%8A%AF>
    2.  DBT: <https://lt.cjdby.net/thread-526768-1-1.html>

### 未使用
```
申威处理器又称"SW处理器"，源自于DEC的Alpha 21164，其研制得到了国家"核高基"专项资金支持。在国家"核高基"重大专项支持下、采用自主指令集，具体负责研发的单位是江南计算机所属于军方研究机构(总参56所)，且具有完全自主知识产权的处理器系列。
```

x86模拟:https://lt.cjdby.net/thread-526768-1-1.html
<https://zh.wikipedia.org/wiki/%E9%BE%99%E8%8A%AF>
'龙芯3A3000流片成功后，龙芯中科技术有限公司总裁胡伟武在《我们的龙芯3号——致龙芯15周年》演讲中表示，“3A3000的通用处理性能已经跨过了国际通用处理器性能的第一个门槛，其单核SPEC
CPU2006性能已经不低于ARM用于服务器的高端处理器、Intel的低端系列（凌动系列）处理器以及威盛处理器，而且3A3000的访存带宽已经与AMD以及Intel的高端系列（酷睿系列）持平。这样的性能对于以党政办公为代表的事务处理应用已经足够。”[8]'

“身在华为，也要支持一下中兴。希望能挺过这一关。
非常赞同这个文章的观点，世间本无所谓核心科技，只是看是不是有足够的时间和空间来成长。
几年前自己创业做公司，产品一直想进入国内的大公司，包括华为中兴等，但基本上美国E公司的V*T*垄断了这些大公司的市场。国内类似我们这样的小公司根本就没有给任何机会进入这些公司的供应链条，更谈不上发展壮大了。
这下好了，估计以后所有国内公司无论如何都会寻找几个国内备胎了，其实只要能融入这些大型公司的供应链条，替代外国产品只是早晚问题。
都一个肩膀扛一个脑袋，啥高科技都架不住你天天琢磨。”
我觉得开始可以像自研芯片一样，用别人的指令集兼容别人的生态系统，然后后面的话，因为linux有时也并不适合所有场景，所以在很多场地上就可以建立自己的生态。咱们现在做的东西，其实并不是重度依赖linux的。

你的观点我很赞同。我发现这几年我们提的东西是有区别呢，开始提的是独立自主，那个时候的确技术都集中在个别国家的个别公司里面，而且都是封闭技术，你自己搞的话，的确是只有独立自主一条路，现在的话，开源和开放的标准已经比较多了，而且技术并不掌握在一个国家的一个公司里面，所以这个时候我们谈自主可控就比较合适。我觉得从技术的角度说的话，这种热点我是希望大家能够关注到做事情的人，不管这个东西到底是有多核心，关键是说，这种踏踏实实做技术的氛围是非常重要的

